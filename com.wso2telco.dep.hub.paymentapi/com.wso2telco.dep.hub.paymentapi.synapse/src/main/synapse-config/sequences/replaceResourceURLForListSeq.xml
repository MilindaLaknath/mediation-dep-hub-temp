<?xml version="1.0" encoding="UTF-8"?>
<sequence name="replaceResourceURLForListSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property name="resourceUrlPrefix" expression="fn:concat(syn:get-property('hubGateway'), syn:get-property('CONTEXT'), syn:get-property('REST_SUB_REQUEST_PATH'), '/amount/')" scope="default" xmlns:fn="http://www.w3.org/2005/xpath-functions"/>
    <class name="com.wso2telco.dep.common.mediation.UtilMediator">
        <property name="propertyValue" value="singlePropertyReplacement"/>
        <property name="propertyName" value="resourceURL"/>
        <property name="propertyPath" value="payload.paymentTransactionList.resourceURL"/>
        <property name="msgContextProperty" value="resourceUrlPrefix"/>
    </class>

    <foreach id="foreach_transactions" expression="//paymentTransactionList/amountTransaction">
        <sequence>
            <property name="originalResourceURL" expression="//amountTransaction/resourceURL"/>
            <property name="resourceId" expression="fn:replace(syn:get-property('originalResourceURL'), '^.*amount/', '')" xmlns:fn="http://www.w3.org/2005/xpath-functions"/>
            <property name="propertyReplacement" expression="fn:concat(syn:get-property('resourceUrlPrefix'), syn:get-property('resourceId'))" scope="default" xmlns:fn="http://www.w3.org/2005/xpath-functions"/>
            <property name="propertyReplacementIndex" expression="get-property('foreach_transactions_FOREACH_COUNTER')" scope="default"/>

            <class name="com.wso2telco.dep.common.mediation.UtilMediator">
                <property name="propertyValue" value="propertyReplacementInArray"/>
                <property name="propertyName" value="resourceURL"/>
                <property name="propertyPath" value="payload.paymentTransactionList.amountTransaction"/>
                <property name="msgContextProperty" value="propertyReplacement"/>
            </class>
        </sequence>
    </foreach>
</sequence>
